generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// FEEDSTOCK MODULE
// ============================================
model FeedstockDelivery {
  id                  String   @id @default(uuid())
  serialNumber        Int      @unique @default(autoincrement())
  date                DateTime
  vehicleId           String?
  vehicleDescription  String?
  deliveryDistanceKm  Float
  weightTonnes        Float?
  volumeM3            Float?
  feedstockType       String
  feedstockTypeOther  String?   // Custom type when feedstockType is "other"
  fuelType            String?
  fuelTypeOther       String?   // Custom type when fuelType is "other"
  fuelAmount          Float?
  notes               String?
  // Location fields for network map
  sourceAddress       String?
  sourceLat           Float?
  sourceLng           Float?
  geocodeStatus       String?  // pending, success, failed
  // Route fields for actual road navigation
  routeGeometry       String?  // GeoJSON LineString as JSON string
  routeDistanceKm     Float?   // Calculated road distance from Mapbox
  routeDurationMin    Float?   // Estimated travel time in minutes
  routeCalculatedAt   DateTime? // When route was last calculated
  routeStatus         String?  // pending, success, failed, no_plant
  // Truck arrival photo
  truckPhotoUrl       String?  // URL to uploaded truck photo
  truckPhotoUploadedAt DateTime? // When the photo was uploaded
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // PURO METHODOLOGY: Biomass category (Section 3.4, Categories A-O)
  puroCategory            String?  // A, B, C, D, E, F, G, H, I, J, K, L, M, N, O
  puroCategoryName        String?  // Human-readable category name

  // PURO METHODOLOGY: Sustainability certification
  sustainabilityCertification String? // FSC, PEFC, RSB, ISCC, SBP, etc.
  certificationNumber     String?
  certificationExpiry     DateTime?

  // PURO METHODOLOGY: Source classification
  isDedicatedCrop         Boolean  @default(false)
  isPrimaryLandDriver     Boolean  @default(false)
  sourceClassification    String?  // RESIDUE, WASTE, DEDICATED_CROP

  // PURO METHODOLOGY: iLUC risk assessment (Section 8.2.3)
  ilucRiskLevel           String?  // LOW, HIGH
  ilucCertificationId     String?

  // PURO METHODOLOGY: Carbon/energy content
  carbonContentPercent    Float?   // For carbon tracking
  lowerHeatingValueGJ     Float?   // GJ per dry tonne (for iLUC calculation)

  // PURO METHODOLOGY: Supply chain emissions (E_biomass, Section 7.3)
  cultivationEmissionsKgCO2e    Float?  // For dedicated crops only
  collectionEmissionsKgCO2e     Float?  // Collection/gathering emissions
  preprocessingEmissionsKgCO2e  Float?  // Chipping, drying, etc.

  // PURO METHODOLOGY: First gathering point (Section 7.3.5)
  firstGatheringPointAddress String?
  firstGatheringPointLat     Float?
  firstGatheringPointLng     Float?

  productionBatches       ProductionBatch[]
  productionAllocations   ProductionFeedstock[]
  transportEvents         TransportEvent[]
  evidence                EvidenceFile[]

  @@index([date])
  @@index([feedstockType])
  @@index([geocodeStatus])
  @@index([routeStatus])
  @@index([puroCategory])
  @@index([ilucRiskLevel])
}

// ============================================
// PRODUCTION MODULE
// ============================================
model ProductionBatch {
  id                          String   @id @default(uuid())
  serialNumber                Int      @unique @default(autoincrement())
  productionDate              DateTime
  feedstockDeliveryId         String?  // Deprecated: use feedstockAllocations instead
  feedstockDelivery           FeedstockDelivery? @relation(fields: [feedstockDeliveryId], references: [id])
  inputFeedstockWeightTonnes  Float
  outputBiocharWeightTonnes   Float
  temperatureMin              Float?
  temperatureMax              Float?
  temperatureAvg              Float?
  status                      String   @default("draft") // draft, complete
  wizardStep                  Int      @default(1)
  notes                       String?
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  // PURO METHODOLOGY: Facility link
  facilityId                  String?
  facility                    Facility? @relation(fields: [facilityId], references: [id])

  // PURO METHODOLOGY: Biochar quality parameters
  organicCarbonPercent        Float?   // C_org from lab test
  totalCarbonPercent          Float?   // C_tot from lab test
  inorganicCarbonPercent      Float?   // C_inorg from lab test
  hydrogenPercent             Float?   // H from lab test
  hCorgRatio                  Float?   // H/C_org molar ratio (Equation 6.5)
  qualityValidationStatus     String   @default("pending") // pending, passed, failed

  // PURO METHODOLOGY: Dry mass (for accurate CORC calculation)
  dryMassTonnes               Float?   // Q_biochar dry weight
  moisturePercent             Float?

  // PURO METHODOLOGY: Direct stack emissions (Section 3.5)
  ch4EmissionsKg              Float?   // Methane emissions at stack
  n2oEmissionsKg              Float?   // Nitrous oxide emissions at stack
  fossilCO2EmissionsKg        Float?   // Fossil CO2 from impurities

  // PURO METHODOLOGY: Co-product allocation (Section 7.5)
  coProductHeatMJ             Float?   // Heat co-product energy
  coProductElectricityKWh     Float?   // Electricity co-product
  coProductOilLitres          Float?   // Bio-oil co-product
  allocationFactorBiochar     Float    @default(1.0) // 0-1, biochar's share

  feedstockAllocations        ProductionFeedstock[]
  energyUsages                EnergyUsage[]
  sequestrationBatches        SequestrationBatch[]
  bcuBatches                  BCUProductionBatch[]
  evidence                    EvidenceFile[]

  // PURO METHODOLOGY: Lab tests and CORC links
  labTests                    BiocharLabTest[]
  corcBatches                 CORCProductionBatch[]

  @@index([productionDate])
  @@index([status])
  @@index([facilityId])
  @@index([qualityValidationStatus])
}

// Join table for Production Batch -> Feedstock Delivery (many-to-many with percentage)
model ProductionFeedstock {
  productionBatchId     String
  feedstockDeliveryId   String
  percentageUsed        Float    // Percentage of feedstock delivery used (0-100)
  weightUsedTonnes      Float?   // Calculated weight based on percentage
  productionBatch       ProductionBatch   @relation(fields: [productionBatchId], references: [id], onDelete: Cascade)
  feedstockDelivery     FeedstockDelivery @relation(fields: [feedstockDeliveryId], references: [id])

  @@id([productionBatchId, feedstockDeliveryId])
}

// ============================================
// ENERGY MODULE
// ============================================
model EnergyUsage {
  id                String   @id @default(uuid())
  scope             String   // production, transport, other
  scopeOther        String?  // Custom scope when scope is "other"
  energyType        String   // electricity, diesel, gas, propane
  energyTypeOther   String?  // Custom type when energyType is "other"
  quantity          Float
  unit              String   // kWh, litres, m3
  periodStart       DateTime
  periodEnd         DateTime
  productionBatchId String?
  productionBatch   ProductionBatch? @relation(fields: [productionBatchId], references: [id])
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  evidence          EvidenceFile[]

  @@index([periodStart])
  @@index([energyType])
}

// ============================================
// TRANSPORT MODULE
// ============================================
model TransportEvent {
  id                    String   @id @default(uuid())
  date                  DateTime
  // Origin location
  originAddress         String?
  originLat             Float?
  originLng             Float?
  // Destination location
  destinationAddress    String?
  destinationLat        Float?
  destinationLng        Float?
  // Route info
  distanceKm            Float
  routeGeometry         String?  // GeoJSON LineString
  routeCalculatedAt     DateTime?
  vehicleId             String?
  vehicleDescription    String?
  fuelType              String?
  fuelTypeOther         String?   // Custom type when fuelType is "other"
  fuelUnit              String?   // Unit for fuel amount (kWh, liters, m³, kg)
  fuelAmount            Float?
  cargoDescription      String?
  feedstockDeliveryId   String?
  feedstockDelivery     FeedstockDelivery? @relation(fields: [feedstockDeliveryId], references: [id])
  sequestrationEventId  String?
  sequestrationEvent    SequestrationEvent? @relation(fields: [sequestrationEventId], references: [id])
  notes                 String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  evidence              EvidenceFile[]

  @@index([date])
}

// ============================================
// SEQUESTRATION MODULE
// ============================================
model SequestrationEvent {
  id                          String    @id @default(uuid())
  storageBeforeDelivery       Boolean   @default(false)
  storageLocation             String?
  storageStartDate            DateTime?
  storageEndDate              DateTime?
  storageContainerIds         String?
  storageConditions           String?
  finalDeliveryDate           DateTime
  deliveryVehicleDescription  String?
  deliveryPostcode            String
  // Destination coordinates for network map
  destinationLat              Float?
  destinationLng              Float?
  geocodeStatus               String?   // pending, success, failed
  // Route fields for actual road navigation
  routeGeometry               String?   // GeoJSON LineString as JSON string
  routeDistanceKm             Float?    // Calculated road distance from Mapbox
  routeDurationMin            Float?    // Estimated travel time in minutes
  routeCalculatedAt           DateTime? // When route was last calculated
  routeStatus                 String?   // pending, success, failed, no_plant
  sequestrationType           String    // soil, compost, construction, other
  sequestrationTypeOther      String?   // Custom type when sequestrationType is "other"
  status                      String    @default("draft") // draft, complete
  wizardStep                  Int       @default(1)
  notes                       String?
  createdAt                   DateTime  @default(now())
  updatedAt                   DateTime  @updatedAt

  // PURO METHODOLOGY: End-use category (Section 3.6)
  endUseCategory              String?   // SOIL_AGRICULTURE, SOIL_FORESTRY, SOIL_URBAN, CONSTRUCTION_CONCRETE, etc.
  endUseSubcategory           String?

  // PURO METHODOLOGY: Soil temperature for BC+200 model (Section 6.2, Table 6.1)
  meanAnnualSoilTempC         Float?    // 7-40°C range
  soilTempRegion              String?   // Sub-national admin region name
  soilTempDataSource          String?   // How temp was determined

  // PURO METHODOLOGY: Calculated persistence (Equation 6.4)
  persistenceFractionPercent  Float?    // PF calculated from H/Corg and soil temp

  // PURO METHODOLOGY: Incorporation details (Section 3.6)
  incorporationMethod         String?   // TILLAGE, TOP_DRESSING, MIXING, EMBEDDING
  incorporationDepthCm        Float?

  // PURO METHODOLOGY: For non-soil applications
  expectedProductLifetimeYears Int?
  endOfLifeFate               String?   // LANDFILL, RECYCLING, INCINERATION

  // PURO METHODOLOGY: Permanence verification
  permanenceVerificationMethod String?  // DOCUMENTATION, SITE_VISIT, REMOTE_SENSING
  reversalRiskAssessment      String?

  batches                     SequestrationBatch[]
  transportEvents             TransportEvent[]
  bcuEvents                   BCUSequestrationEvent[]
  evidence                    EvidenceFile[]

  // PURO METHODOLOGY: CORC links
  corcEvents                  CORCSequestrationEvent[]

  @@index([finalDeliveryDate])
  @@index([status])
  @@index([geocodeStatus])
  @@index([routeStatus])
  @@index([endUseCategory])
}

model SequestrationBatch {
  sequestrationId   String
  productionBatchId String
  quantityTonnes    Float
  sequestration     SequestrationEvent @relation(fields: [sequestrationId], references: [id], onDelete: Cascade)
  productionBatch   ProductionBatch    @relation(fields: [productionBatchId], references: [id])

  @@id([sequestrationId, productionBatchId])
}

// ============================================
// EVIDENCE FILES
// ============================================
model EvidenceFile {
  id                    String   @id @default(uuid())
  fileName              String
  fileType              String   // pdf, image, csv, other
  fileSize              Int
  mimeType              String
  storagePath           String   // Simulated path
  category              String   // sustainability, transport_license, weight_in, biochar_out, temperature_log, delivery, regulatory, storage, general, lab_report
  description           String?
  uploadedAt            DateTime @default(now())

  // Generic polymorphic relations - entity can link to multiple parent types
  feedstockDeliveryId   String?
  feedstockDelivery     FeedstockDelivery? @relation(fields: [feedstockDeliveryId], references: [id], onDelete: Cascade)

  productionBatchId     String?
  productionBatch       ProductionBatch? @relation(fields: [productionBatchId], references: [id], onDelete: Cascade)

  energyUsageId         String?
  energyUsage           EnergyUsage? @relation(fields: [energyUsageId], references: [id], onDelete: Cascade)

  transportEventId      String?
  transportEvent        TransportEvent? @relation(fields: [transportEventId], references: [id], onDelete: Cascade)

  sequestrationEventId  String?
  sequestrationEvent    SequestrationEvent? @relation(fields: [sequestrationEventId], references: [id], onDelete: Cascade)

  bcuId                 String?
  bcu                   BCU? @relation(fields: [bcuId], references: [id], onDelete: Cascade)

  // PURO METHODOLOGY: CORC relation
  corcId                String?
  corc                  CORCIssuance? @relation(fields: [corcId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([uploadedAt])
}

// ============================================
// BCU (Biochar Carbon Unit) MODULE
// ============================================
model BCU {
  id                    String   @id @default(uuid())
  quantityTonnesCO2e    Float
  issuanceDate          DateTime
  status                String   @default("issued") // issued, transferred, retired
  registrySerialNumber  String   @unique
  ownerName             String?
  accountId             String?
  retirementDate        DateTime?
  retirementBeneficiary String?
  notes                 String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  productionBatches     BCUProductionBatch[]
  sequestrationEvents   BCUSequestrationEvent[]
  evidence              EvidenceFile[]

  @@index([status])
  @@index([issuanceDate])
}

model BCUProductionBatch {
  bcuId             String
  productionBatchId String
  bcu               BCU             @relation(fields: [bcuId], references: [id], onDelete: Cascade)
  productionBatch   ProductionBatch @relation(fields: [productionBatchId], references: [id])

  @@id([bcuId, productionBatchId])
}

model BCUSequestrationEvent {
  bcuId           String
  sequestrationId String
  bcu             BCU                @relation(fields: [bcuId], references: [id], onDelete: Cascade)
  sequestration   SequestrationEvent @relation(fields: [sequestrationId], references: [id])

  @@id([bcuId, sequestrationId])
}

// ============================================
// PLANT SETTINGS (Singleton)
// ============================================
model PlantSettings {
  id          String   @id @default("singleton")
  plantName   String   @default("Biochar Plant")
  address     String?
  lat         Float?
  lng         Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============================================
// GEOCODE CACHE
// ============================================
model GeocodeCache {
  id               String   @id @default(uuid())
  queryString      String   @unique
  lat              Float
  lng              Float
  formattedAddress String?
  createdAt        DateTime @default(now())
  expiresAt        DateTime

  @@index([queryString])
  @@index([expiresAt])
}

// ============================================
// ROUTE CACHE (Mapbox Directions API)
// ============================================
model RouteCache {
  id              String   @id @default(uuid())
  originLat       Float
  originLng       Float
  destLat         Float
  destLng         Float
  distanceKm      Float
  durationMin     Float?
  geometry        String   // GeoJSON LineString as JSON string
  createdAt       DateTime @default(now())
  expiresAt       DateTime // 30-day TTL

  @@unique([originLat, originLng, destLat, destLng])
  @@index([expiresAt])
}

// ============================================
// EMISSION FACTORS (Custom Datasets)
// ============================================
model EmissionFactor {
  id              String   @id @default(uuid())
  name            String   // e.g., "Grid Electricity UK", "Diesel combustion"
  category        String   // electricity, fuel, transport, feedstock, other
  categoryOther   String?  // Custom category when category is "other"
  unit            String   // e.g., "kgCO2e/kWh", "kgCO2e/L", "kgCO2e/km"
  year            Int      // Reference year for the factor
  source          String   // IPCC, DEFRA, EPA, Custom, etc.
  sourceOther     String?  // Custom source name when source is "other"
  region          String?  // UK, US, EU, Global, etc.

  // GHG breakdown
  co2Factor       Float?   // kg CO2 per unit
  ch4Factor       Float?   // kg CH4 per unit
  n2oFactor       Float?   // kg N2O per unit
  totalCo2e       Float    // Total kg CO2e per unit (calculated or provided)

  // GWP values used (for transparency)
  gwpCh4          Float?   // GWP for CH4 (e.g., 28 for AR5)
  gwpN2o          Float?   // GWP for N2O (e.g., 265 for AR5)

  notes           String?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([name, year, source])
  @@index([category])
  @@index([year])
  @@index([source])
  @@index([isActive])
}

// ============================================
// QR CODE SCAN LOGGING
// ============================================
model QRScanLog {
  id              String   @id @default(uuid())
  scannedAt       DateTime @default(now())

  // What was scanned
  entityType      String   // production, feedstock, sequestration, transport, energy, registry
  entityId        String

  // Context
  scanContext     String?  // navigation, batch_link, verification
  sourcePagePath  String?
  scanResult      String   // success, entity_not_found, invalid_qr

  // Device info
  userAgent       String?

  createdAt       DateTime @default(now())

  @@index([entityType, entityId])
  @@index([scannedAt])
}

// ============================================
// PURO METHODOLOGY: FACILITY
// ============================================
model Facility {
  id                              String   @id @default(uuid())
  name                            String
  registrationNumber              String   @unique
  baselineType                    String   @default("NEW_BUILT") // NEW_BUILT, RETROFIT_FACILITY, CHARCOAL_REPURPOSE

  // Location
  address                         String?
  lat                             Float?
  lng                             Float?
  country                         String?

  // Crediting period (10 years default)
  creditingPeriodStart            DateTime
  creditingPeriodEnd              DateTime

  // Infrastructure for embodied emissions (E_emb)
  infrastructureLifetimeYears     Int      @default(10)
  totalInfrastructureEmissionsTCO2e Float  @default(0)

  createdAt                       DateTime @default(now())
  updatedAt                       DateTime @updatedAt

  monitoringPeriods               MonitoringPeriod[]
  productionBatches               ProductionBatch[]
  leakageAssessments              LeakageAssessment[]

  @@index([baselineType])
}

// ============================================
// PURO METHODOLOGY: MONITORING PERIOD
// ============================================
model MonitoringPeriod {
  id                              String   @id @default(uuid())
  facilityId                      String
  facility                        Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  periodStart                     DateTime
  periodEnd                       DateTime
  status                          String   @default("active") // active, closed, verified

  // CORC calculation results (cached after calculation)
  cStoredTCO2e                    Float?
  cBaselineTCO2e                  Float?
  cLossTCO2e                      Float?
  persistenceFractionPercent      Float?
  eProjectTCO2e                   Float?
  eLeakageTCO2e                   Float?
  netCORCsTCO2e                   Float?

  calculatedAt                    DateTime?

  createdAt                       DateTime @default(now())
  updatedAt                       DateTime @updatedAt

  corcIssuances                   CORCIssuance[]

  @@index([facilityId])
  @@index([status])
  @@index([periodStart, periodEnd])
}

// ============================================
// PURO METHODOLOGY: BIOCHAR LAB TEST
// ============================================
model BiocharLabTest {
  id                              String   @id @default(uuid())
  productionBatchId               String
  productionBatch                 ProductionBatch @relation(fields: [productionBatchId], references: [id], onDelete: Cascade)

  testDate                        DateTime
  labName                         String
  labAccreditation                String?

  // Carbon analysis (required for Puro)
  totalCarbonPercent              Float    // C_tot
  inorganicCarbonPercent          Float    @default(0) // C_inorg
  organicCarbonPercent            Float    // C_org = C_tot - C_inorg
  hydrogenPercent                 Float    // H

  // Calculated H/C_org ratio (Equation 6.5)
  hCorgRatio                      Float

  // Quality validation (must be <= 0.7 per Puro methodology)
  passesQualityThreshold          Boolean

  // Analytical methods
  carbonMethod                    String?  // ISO_16948, DIN_51732, ASTM_E870
  inorganicCarbonMethod           String?  // DIN_51726, ISO_925, ASTM_D4373

  // Moisture
  moisturePercent                 Float?
  moistureMethod                  String?  // ISO_589, DIN_51718, ASTM_D1762

  // Nitrogen (optional)
  nitrogenPercent                 Float?

  // Evidence
  reportFileId                    String?

  createdAt                       DateTime @default(now())
  updatedAt                       DateTime @updatedAt

  @@index([productionBatchId])
  @@index([testDate])
}

// ============================================
// PURO METHODOLOGY: CORC ISSUANCE (replaces BCU)
// ============================================
model CORCIssuance {
  id                              String   @id @default(uuid())
  serialNumber                    String   @unique
  monitoringPeriodId              String
  monitoringPeriod                MonitoringPeriod @relation(fields: [monitoringPeriodId], references: [id])

  // CORC calculation breakdown (Equation 5.1)
  cStoredTCO2e                    Float    // Gross carbon stored
  cBaselineTCO2e                  Float    // Baseline carbon storage
  cLossTCO2e                      Float    // Carbon loss (from persistence)
  persistenceFractionPercent      Float    // BC+200 persistence factor
  eProjectTCO2e                   Float    // Project emissions (LCA)
  eLeakageTCO2e                   Float    // Leakage emissions
  netCORCsTCO2e                   Float    // Final CORC amount

  // Permanence type
  permanenceType                  String   @default("BC200+") // BC100+, BC200+

  // Status lifecycle
  status                          String   @default("draft") // draft, issued, retired
  issuanceDate                    DateTime?

  // Ownership
  ownerName                       String?
  ownerAccountId                  String?

  // Retirement
  retirementDate                  DateTime?
  retirementBeneficiary           String?
  retirementPurpose               String?

  notes                           String?
  createdAt                       DateTime @default(now())
  updatedAt                       DateTime @updatedAt

  productionBatches               CORCProductionBatch[]
  sequestrationEvents             CORCSequestrationEvent[]
  evidence                        EvidenceFile[]

  @@index([status])
  @@index([monitoringPeriodId])
  @@index([issuanceDate])
}

// ============================================
// PURO METHODOLOGY: LEAKAGE ASSESSMENT
// ============================================
model LeakageAssessment {
  id                              String   @id @default(uuid())
  facilityId                      String
  facility                        Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  monitoringPeriodId              String?

  assessmentDate                  DateTime
  assessorName                    String?

  // Ecological leakage - facility construction (Section 8.2.1)
  facilityEcologicalStatus        String   @default("MITIGATED") // MITIGATED, QUANTIFIED, NOT_APPLICABLE
  facilityEcologicalKgCO2e        Float    @default(0)
  facilityEcologicalNotes         String?

  // Ecological leakage - biomass sourcing (Section 8.2.2)
  biomassEcologicalStatus         String   @default("MITIGATED")
  biomassEcologicalKgCO2e         Float    @default(0)
  biomassEcologicalNotes          String?

  // Market/activity shifting leakage - AFOLU sector (Section 8.2.3)
  afoluLeakageStatus              String   @default("MITIGATED")
  afoluLeakageKgCO2e              Float    @default(0)
  afoluNotes                      String?

  // Market/activity shifting leakage - energy/materials (Section 8.2.4-8.2.6)
  energyMaterialLeakageStatus     String   @default("NOT_APPLICABLE")
  energyMaterialLeakageKgCO2e     Float    @default(0)
  energyMaterialNotes             String?

  // iLUC contribution (for high-risk feedstocks per Section 8.3.4)
  ilucContributionKgCO2e          Float    @default(0)

  // Total leakage (Equation 8.1: E_leakage = L_ECO + L_MA)
  totalLeakageKgCO2e              Float    @default(0)

  notes                           String?
  createdAt                       DateTime @default(now())
  updatedAt                       DateTime @updatedAt

  @@index([facilityId])
  @@index([monitoringPeriodId])
}

// ============================================
// PURO METHODOLOGY: CORC JOIN TABLES
// ============================================
model CORCProductionBatch {
  corcId                          String
  productionBatchId               String
  corc                            CORCIssuance    @relation(fields: [corcId], references: [id], onDelete: Cascade)
  productionBatch                 ProductionBatch @relation(fields: [productionBatchId], references: [id])

  @@id([corcId, productionBatchId])
}

model CORCSequestrationEvent {
  corcId                          String
  sequestrationId                 String
  corc                            CORCIssuance       @relation(fields: [corcId], references: [id], onDelete: Cascade)
  sequestration                   SequestrationEvent @relation(fields: [sequestrationId], references: [id])

  @@id([corcId, sequestrationId])
}
